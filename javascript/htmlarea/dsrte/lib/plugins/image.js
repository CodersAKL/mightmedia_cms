var dsRTE_insertImage=function(){this.ExecuteCommand=function(a,b,c){c.slideToggle();return true};this.PrepareCommand=function(b,c,d,f){var g=c;$('#'+b.iframe.id+'-'+c+'-ok').click(function(){b.frame.focus();$.ajaxFileUpload({url:f.attr('path'),secureuri:false,fileElementId:b.iframe.id+'-'+g+'-file',dataType:'json',success:function(a,s){if(a.error){alert(a.error)}else{b.frame.focus();$('#'+c).val('');d.slideUp();if($.browser.msie){b.iframe.rng.execCommand('insertimage',false,a.path+'/'+encodeURIComponent(a.file));b.iframe.rng.select();b.iframe.rng.execCommand('unselect',false,null);b.updateIERange()}else{b.doc.execCommand('insertimage',false,a.path+'/'+encodeURIComponent(a.file))}}},error:function(a,s,e){alert(e+': '+a.responseText)}})});return true}};dsRTE.RegisterPlugin(new dsRTE_insertImage(),'image');
